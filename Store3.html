<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat√°logo de Productos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 20px; color: white; }
    .header h1 { font-size: 2rem; margin: 0; }

    /* Barra de b√∫squeda */
    .search-bar { display: flex; justify-content: center; margin: 20px 0; }
    .search-bar input {
      width: 100%; max-width: 500px; padding: 10px 15px; border-radius: 25px;
      border: none; outline: none; font-size: 1rem;
    }

    .categories { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
    .category-btn {
      padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer;
      background: rgba(255,255,255,0.9); font-weight: bold;
      transition: all 0.3s ease;
    }
    .category-btn:hover, .category-btn.active {
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color: white;
    }

    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 15px; }
    .product-card {
      background: white; border-radius: 15px; overflow: hidden;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15); cursor: pointer;
      transition: transform 0.2s;
    }
    .product-card:hover { transform: translateY(-5px); }
    .product-image { width: 100%; height: 180px; object-fit: cover; } /* Preview recortado */
    .product-info { padding: 12px; }
    .product-name { font-size: 1rem; font-weight: bold; margin-bottom: 5px; }
    .product-price { font-size: 1.1rem; color: #667eea; font-weight: bold; margin-bottom: 5px; }
    .product-category { font-size: 0.8rem; background: #eee; padding: 2px 8px; border-radius: 10px; display: inline-block; }

    /* Bot√≥n cargar m√°s */
    .load-more {
      display: block; margin: 20px auto; padding: 10px 20px; border: none;
      border-radius: 25px; background: white; cursor: pointer; font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .load-more:hover {
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color: white;
    }

    /* Modal */
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.8);
      justify-content: center; align-items: center; padding: 10px;
    }
    .modal-content {
      background: white; border-radius: 15px; max-width: 800px; width: 100%;
      max-height: 90vh; overflow-y: auto; position: relative;
    }
    .modal-header {
      padding: 15px; background: linear-gradient(135deg,#667eea,#764ba2);
      color: white; border-radius: 15px 15px 0 0; position: relative;
    }
    .close { position: absolute; right: 20px; top: 15px; cursor: pointer; font-size: 24px; }
    .modal-body { padding: 15px; }

    /* Carrusel */
    .carousel { position: relative; margin-bottom: 15px; text-align: center; }
    .carousel img {
      max-width: 100%; max-height: 250px; object-fit: contain; border-radius: 10px;
      cursor: pointer;
    }
    .carousel-btn {
      position: absolute; top: 50%; transform: translateY(-50%);
      background: rgba(0,0,0,0.5); color: white; border: none;
      font-size: 20px; cursor: pointer; padding: 8px; border-radius: 50%;
    }
    .carousel-btn.left { left: 10px; }
    .carousel-btn.right { right: 10px; }

    .modal-price { font-size: 1.3rem; color: #667eea; font-weight: bold; margin-bottom: 10px; }
    .share-container { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
    .share-btn {
      background: linear-gradient(135deg,#667eea,#764ba2);
      color: white; border: none; padding: 8px 16px; border-radius: 20px;
      cursor: pointer; font-weight: bold;
    }
    .share-url { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ccc; min-width: 200px; }

    /* Lightbox (imagen fullscreen) */
    .lightbox {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.95); justify-content: center; align-items: center; z-index: 2000;
    }
    .lightbox img {
      max-width: 90%; max-height: 90%; object-fit: contain;
    }
    .lightbox-close {
      position: absolute; top: 20px; right: 30px; font-size: 35px;
      color: white; cursor: pointer; font-weight: bold;
    }

    /* üì± Mejoras responsive */
    @media (max-width: 600px) {
      .product-image { height: 150px; }
      .modal-content { width: 95%; }
      .carousel img { max-height: 200px; }
      .product-name { font-size: 0.9rem; }
      .product-price { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üõçÔ∏è Cat√°logo de Productos</h1>
      <p>Descubre nuestros incre√≠bles productos</p>
    </div>

    <!-- üîç Barra de b√∫squeda -->
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Buscar productos...">
    </div>

    <div id="categories" class="categories"></div>
    <div id="productsGrid" class="products-grid"></div>
    <button id="loadMoreBtn" class="load-more">Cargar m√°s</button>
  </div>

  <!-- Modal producto -->
  <div id="productModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modalTitle"></span>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <!-- üñºÔ∏è Carrusel -->
        <div class="carousel">
          <button class="carousel-btn left" onclick="prevImage()">&#10094;</button>
          <img id="carouselImage" src="" alt="Imagen producto" onclick="openLightbox()">
          <button class="carousel-btn right" onclick="nextImage()">&#10095;</button>
        </div>
        <div id="modalPrice" class="modal-price"></div>
        <div id="modalDescription"></div>
        <div class="share-container">
          <button id="shareBtn" class="share-btn">üîó Generar Link</button>
          <input type="text" id="shareUrl" class="share-url" readonly />
        </div>
      </div>
    </div>
  </div>

  <!-- Lightbox fullscreen -->
  <div id="lightbox" class="lightbox" onclick="closeLightbox()">
    <span class="lightbox-close">&times;</span>
    <img id="lightboxImage" src="">
  </div>

  <script>
    let products = [];
    let currentProduct = null;
    let currentImages = [];
    let currentIndex = 0;

    let visibleCount = 12;
    const perPage = 12;

    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTL98VUgPTrUmCr4yEKah1YpiEZf7qnQO2cXev14OM17P52F1X8sBm17WthSRyU4SCZhRnPPJp5DVty/pub?gid=0&single=true&output=csv";

    fetch(sheetUrl)
      .then(res => res.text())
      .then(csv => {
        Papa.parse(csv, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            products = results.data.filter(p => p.nombre && p.precio && p.categoria);
            createCategoryButtons();
            displayProducts();
            loadFromUrl();
          }
        });
      });

    function createCategoryButtons() {
      const cats = [...new Set(products.map(p => p.categoria))];
      const categoriesDiv = document.getElementById("categories");
      categoriesDiv.innerHTML = `<button class="category-btn active" onclick="filterProducts('todos', this)">Todos</button>`;
      cats.forEach(cat => {
        categoriesDiv.innerHTML += `<button class="category-btn" onclick="filterProducts('${cat}', this)">${cat}</button>`;
      });
    }

    function filterProducts(cat, btn) {
      document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentCategory = cat;
      visibleCount = perPage;
      displayProducts(cat);
    }

    function displayProducts(cat="todos") {
      const grid = document.getElementById("productsGrid");
      const searchText = document.getElementById("searchInput").value.toLowerCase();

      let filtered = products.filter(p =>
        (cat==="todos" || p.categoria===cat) &&
        (p.nombre.toLowerCase().includes(searchText) || (p.descripcion||"").toLowerCase().includes(searchText))
      );

      let toShow = filtered.slice(0, visibleCount);

      if (toShow.length===0) {
        grid.innerHTML = "<p style='color:white;'>No hay productos disponibles.</p>";
        document.getElementById("loadMoreBtn").style.display = "none";
        return;
      }

      grid.innerHTML = toShow.map(p => `
        <div class="product-card" onclick="openModal('${p.nombre}')">
          <img class="product-image" src="${p.imagen1 || 'https://via.placeholder.com/250x200?text=Sin+Imagen'}" alt="${p.nombre}">
          <div class="product-info">
            <div class="product-name">${p.nombre}</div>
            <div class="product-price">$${parseFloat(p.precio).toLocaleString('es-CO')}</div>
            <div class="product-category">${p.categoria}</div>
          </div>
        </div>
      `).join('');

      document.getElementById("loadMoreBtn").style.display = filtered.length > visibleCount ? "block" : "none";
    }

    document.getElementById("loadMoreBtn").onclick = function() {
      visibleCount += perPage;
      displayProducts(currentCategory);
    };

    document.getElementById("searchInput").addEventListener("input", () => {
      visibleCount = perPage;
      displayProducts(currentCategory);
    });

    function openModal(name) {
      const product = products.find(p => p.nombre === name);
      if (!product) return;
      currentProduct = product;

      document.getElementById("modalTitle").textContent = product.nombre;
      document.getElementById("modalPrice").textContent = "$" + parseFloat(product.precio).toLocaleString('es-CO');
      document.getElementById("modalDescription").textContent = product.descripcion || "Sin descripci√≥n disponible";

      currentImages = [product.imagen1, product.imagen2, product.imagen3, product.imagen4, product.imagen5].filter(Boolean);
      currentIndex = 0;
      updateCarousel();

      document.getElementById("productModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("productModal").style.display = "none";
      currentProduct = null;
    }

    function updateCarousel() {
      if (currentImages.length > 0) {
        document.getElementById("carouselImage").src = currentImages[currentIndex];
      } else {
        document.getElementById("carouselImage").src = "https://via.placeholder.com/400x200?text=Sin+Imagen";
      }
    }
    function prevImage() {
      if (currentImages.length > 0) {
        currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
        updateCarousel();
      }
    }
    function nextImage() {
      if (currentImages.length > 0) {
        currentIndex = (currentIndex + 1) % currentImages.length;
        updateCarousel();
      }
    }

    // Lightbox
    function openLightbox() {
      document.getElementById("lightboxImage").src = currentImages[currentIndex];
      document.getElementById("lightbox").style.display = "flex";
    }
    function closeLightbox() {
      document.getElementById("lightbox").style.display = "none";
    }

    document.getElementById("shareBtn").onclick = function() {
      if (!currentProduct) return;
      const base = window.location.origin + window.location.pathname;
      const link = base + "?producto=" + encodeURIComponent(currentProduct.nombre);
      const shareUrl = document.getElementById("shareUrl");
      shareUrl.value = link;
      shareUrl.select();
      document.execCommand("copy");
      this.textContent = "‚úÖ Copiado!";
      setTimeout(()=> this.textContent = "üîó Generar Link", 2000);
    };

    function loadFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const prod = params.get("producto");
      if (prod) openModal(decodeURIComponent(prod));
    }

    window.onclick = function(e) {
      if (e.target.id === "productModal") closeModal();
      if (e.target.id === "lightbox") closeLightbox();
    };

    let currentCategory = "todos";
  </script>
</body>
</html>
