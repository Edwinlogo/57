<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat√°logo de Productos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 40px; color: white; }
    .header h1 { font-size: 2.5rem; margin: 0; }
    .categories { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
    .category-btn {
      padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer;
      background: rgba(255,255,255,0.9); font-weight: bold;
      transition: all 0.3s ease;
    }
    .category-btn:hover, .category-btn.active {
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color: white;
    }
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px,1fr)); gap: 20px; }
    .product-card {
      background: white; border-radius: 15px; overflow: hidden;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15); cursor: pointer;
      transition: transform 0.2s;
    }
    .product-card:hover { transform: translateY(-5px); }
    .product-image { width: 100%; height: 200px; object-fit: cover; }
    .product-info { padding: 15px; }
    .product-name { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; }
    .product-price { font-size: 1.2rem; color: #667eea; font-weight: bold; margin-bottom: 5px; }
    .product-category { font-size: 0.9rem; background: #eee; padding: 2px 10px; border-radius: 10px; display: inline-block; }

    /* Modal */
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.8);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; border-radius: 15px; max-width: 800px; width: 90%;
      max-height: 90vh; overflow-y: auto;
    }
    .modal-header {
      padding: 20px; background: linear-gradient(135deg,#667eea,#764ba2);
      color: white; border-radius: 15px 15px 0 0; position: relative;
    }
    .close { position: absolute; right: 20px; top: 20px; cursor: pointer; font-size: 24px; }
    .modal-body { padding: 20px; }
    .modal-images { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
    .modal-images img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; }
    .modal-price { font-size: 1.5rem; color: #667eea; font-weight: bold; margin-bottom: 10px; }
    .share-container { display: flex; gap: 10px; margin-top: 15px; }
    .share-btn {
      background: linear-gradient(135deg,#667eea,#764ba2);
      color: white; border: none; padding: 8px 16px; border-radius: 20px;
      cursor: pointer; font-weight: bold;
    }
    .share-url { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üõçÔ∏è Cat√°logo de Productos</h1>
      <p>Descubre nuestros incre√≠bles productos</p>
    </div>

    <div id="categories" class="categories"></div>
    <div id="productsGrid" class="products-grid"></div>
  </div>

  <!-- Modal -->
  <div id="productModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modalTitle"></span>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div id="modalImages" class="modal-images"></div>
        <div id="modalPrice" class="modal-price"></div>
        <div id="modalDescription"></div>
        <div class="share-container">
          <button id="shareBtn" class="share-btn">üîó Generar Link</button>
          <input type="text" id="shareUrl" class="share-url" readonly />
        </div>
      </div>
    </div>
  </div>

  <script>
    let products = [];
    let currentProduct = null;

    // üîó Pega aqu√≠ tu link de Google Sheets publicado como CSV
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTL98VUgPTrUmCr4yEKah1YpiEZf7qnQO2cXev14OM17P52F1X8sBm17WthSRyU4SCZhRnPPJp5DVty/pub?gid=0&single=true&output=csv";

    fetch(sheetUrl)
      .then(res => res.text())
      .then(csv => {
        Papa.parse(csv, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            products = results.data.filter(p => p.nombre && p.precio && p.categoria);
            createCategoryButtons();
            displayProducts();
            loadFromUrl();
          }
        });
      });

    function createCategoryButtons() {
      const cats = [...new Set(products.map(p => p.categoria))];
      const categoriesDiv = document.getElementById("categories");
      categoriesDiv.innerHTML = `<button class="category-btn active" onclick="filterProducts('todos', this)">Todos</button>`;
      cats.forEach(cat => {
        categoriesDiv.innerHTML += `<button class="category-btn" onclick="filterProducts('${cat}', this)">${cat}</button>`;
      });
    }

    function filterProducts(cat, btn) {
      document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      displayProducts(cat);
    }

    function displayProducts(cat="todos") {
      const grid = document.getElementById("productsGrid");
      let filtered = cat==="todos" ? products : products.filter(p => p.categoria===cat);
      if (filtered.length===0) {
        grid.innerHTML = "<p style='color:white;'>No hay productos en esta categor√≠a.</p>";
        return;
      }
      grid.innerHTML = filtered.map(p => `
        <div class="product-card" onclick="openModal('${p.nombre}')">
          <img class="product-image" src="${p.imagen1 || 'https://via.placeholder.com/250x200?text=Sin+Imagen'}" alt="${p.nombre}">
          <div class="product-info">
            <div class="product-name">${p.nombre}</div>
            <div class="product-price">$${parseFloat(p.precio).toLocaleString('es-CO')}</div>
            <div class="product-category">${p.categoria}</div>
          </div>
        </div>
      `).join('');
    }

    function openModal(name) {
      const product = products.find(p => p.nombre === name);
      if (!product) return;
      currentProduct = product;

      document.getElementById("modalTitle").textContent = product.nombre;
      document.getElementById("modalPrice").textContent = "$" + parseFloat(product.precio).toLocaleString('es-CO');
      document.getElementById("modalDescription").textContent = product.descripcion || "Sin descripci√≥n disponible";

      const imgs = [product.imagen1, product.imagen2, product.imagen3, product.imagen4, product.imagen5].filter(Boolean);
      document.getElementById("modalImages").innerHTML = imgs.length > 0 ? imgs.map(img => `<img src="${img}">`).join("") : `<img src="https://via.placeholder.com/400x200?text=Sin+Imagen">`;

      document.getElementById("productModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("productModal").style.display = "none";
      currentProduct = null;
    }

    document.getElementById("shareBtn").onclick = function() {
      if (!currentProduct) return;
      const base = window.location.origin + window.location.pathname;
      const link = base + "?producto=" + encodeURIComponent(currentProduct.nombre);
      const shareUrl = document.getElementById("shareUrl");
      shareUrl.value = link;
      shareUrl.select();
      document.execCommand("copy");
      this.textContent = "‚úÖ Copiado!";
      setTimeout(()=> this.textContent = "üîó Generar Link", 2000);
    };

    // Cargar producto directo desde URL (?producto=...)
    function loadFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const prod = params.get("producto");
      if (prod) openModal(decodeURIComponent(prod));
    }

    // Cerrar modal al hacer clic fuera
    window.onclick = function(e) {
      if (e.target.id === "productModal") closeModal();
    };
  </script>
</body>
</html>
