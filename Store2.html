<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catálogo de Productos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #333; color: #fff; padding: 10px; text-align: center; }
    #categorias { margin: 10px; text-align: center; }
    #categorias button { margin: 5px; padding: 8px 12px; cursor: pointer; }
    #busqueda { margin: 10px auto; display: block; padding: 8px; width: 90%; max-width: 400px; }
    #productos { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding: 15px; }

    .producto { border: 1px solid #ccc; border-radius: 8px; padding: 10px; text-align: center; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .producto img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 6px; cursor: pointer; }
    .producto h3 { margin: 10px 0 5px; font-size: 18px; }
    .producto p { margin: 5px 0; font-size: 14px; }

    /* Modal */
    #modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
    #modal-content { background: #fff; margin: 5% auto; padding: 20px; width: 90%; max-width: 600px; border-radius: 8px; position: relative; text-align: center; }
    #modal h2 { margin-top: 0; }
    #modal p { font-size: 14px; }
    .close { position: absolute; top: 10px; right: 15px; font-size: 24px; cursor: pointer; }

    .carousel { position: relative; max-width: 100%; }
    .carousel img { width: 100%; height: auto; object-fit: contain; cursor: pointer; }
    .prev, .next { cursor: pointer; position: absolute; top: 50%; transform: translateY(-50%); font-size: 30px; background: rgba(0,0,0,0.5); color: white; padding: 5px 10px; border-radius: 50%; }
    .prev { left: 10px; }
    .next { right: 10px; }

    /* Pantalla completa para imagen */
    #fullscreen-view { display: none; position: fixed; z-index: 2000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); justify-content: center; align-items: center; }
    #fullscreen-view img { max-width: 95%; max-height: 95%; object-fit: contain; }
    #close-fullscreen { position: absolute; top: 20px; right: 30px; font-size: 40px; color: #fff; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>Catálogo de Productos</h1>
  </header>
  <input type="text" id="busqueda" placeholder="Buscar productos...">
  <div id="categorias"></div>
  <div id="productos"></div>

  <!-- Modal -->
  <div id="modal">
    <div id="modal-content">
      <span class="close">&times;</span>
      <h2 id="modal-nombre"></h2>
      <div class="carousel">
        <span class="prev">&#10094;</span>
        <img id="modal-imagen" src="" alt="">
        <span class="next">&#10095;</span>
      </div>
      <p id="modal-precio"></p>
      <p id="modal-descripcion"></p>
      <button id="shareBtn">Compartir producto</button>
    </div>
  </div>

  <!-- Vista fullscreen -->
  <div id="fullscreen-view">
    <span id="close-fullscreen">&times;</span>
    <img id="fullscreen-img" src="" alt="">
  </div>

  <script>
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2qA4It3yYd2xKUVBPFezHxl6a5MM2uMzNRRaD7eFmQmU8I6GJUP3ChnqSibdYHw/pub?gid=0&single=true&output=csv";
    let productos = [], productosFiltrados = [], imagenesModal = [], indiceImagen = 0;
    const contenedor = document.getElementById("productos");
    const categoriasDiv = document.getElementById("categorias");
    const busquedaInput = document.getElementById("busqueda");

    // Modal
    const modal = document.getElementById("modal");
    const modalNombre = document.getElementById("modal-nombre");
    const modalImagen = document.getElementById("modal-imagen");
    const modalPrecio = document.getElementById("modal-precio");
    const modalDescripcion = document.getElementById("modal-descripcion");
    const closeModal = document.querySelector(".close");

    // Fullscreen
    const fullscreenView = document.getElementById("fullscreen-view");
    const fullscreenImg = document.getElementById("fullscreen-img");
    const closeFullscreen = document.getElementById("close-fullscreen");

    // Cargar productos
    fetch(url).then(res => res.text()).then(data => {
      const filas = data.split("\n").map(f => f.split(","));
      const headers = filas[0];
      productos = filas.slice(1).map(fila => {
        let obj = {};
        headers.forEach((h, i) => obj[h.trim()] = fila[i] ? fila[i].trim() : "");
        obj.imagenes = [obj.Imagen1, obj.Imagen2, obj.Imagen3, obj.Imagen4, obj.Imagen5].filter(x => x);
        return obj;
      });
      mostrarCategorias();
      mostrarProductos(productos);
      productosFiltrados = productos;
      verificarParametroURL();
    });

    function mostrarCategorias() {
      const cats = [...new Set(productos.map(p => p.Categoria))];
      categoriasDiv.innerHTML = `<button onclick="filtrarCategoria('all')">Todos</button>` +
        cats.map(c => `<button onclick="filtrarCategoria('${c}')">${c}</button>`).join("");
    }

    function mostrarProductos(lista) {
      contenedor.innerHTML = "";
      lista.forEach((p, idx) => {
        const div = document.createElement("div");
        div.className = "producto";
        div.innerHTML = `
          <img src="${p.Imagen1}" alt="${p.Nombre}" onclick="abrirModal(${productos.indexOf(p)})">
          <h3>${p.Nombre}</h3>
          <p><strong>$${p.Precio}</strong></p>
          <p>${p.Categoria}</p>
        `;
        contenedor.appendChild(div);
      });
    }

    function filtrarCategoria(cat) {
      productosFiltrados = (cat === 'all') ? productos : productos.filter(p => p.Categoria === cat);
      mostrarProductos(productosFiltrados);
    }

    // Búsqueda
    busquedaInput.addEventListener("input", () => {
      const q = busquedaInput.value.toLowerCase();
      productosFiltrados = productos.filter(p =>
        p.Nombre.toLowerCase().includes(q) || p.Descripcion.toLowerCase().includes(q)
      );
      mostrarProductos(productosFiltrados);
    });

    // Modal
    function abrirModal(i) {
      const p = productos[i];
      modal.style.display = "block";
      modalNombre.textContent = p.Nombre;
      modalPrecio.textContent = "Precio: $" + p.Precio;
      modalDescripcion.textContent = p.Descripcion;
      imagenesModal = p.imagenes;
      indiceImagen = 0;
      mostrarImagenModal();

      document.getElementById("shareBtn").onclick = () => {
        const urlCompartir = window.location.origin + window.location.pathname + "?producto=" + encodeURIComponent(p.Nombre);
        navigator.clipboard.writeText(urlCompartir);
        alert("Enlace copiado: " + urlCompartir);
      };
    }

    function mostrarImagenModal() {
      modalImagen.src = imagenesModal[indiceImagen];
    }

    document.querySelector(".prev").onclick = () => {
      indiceImagen = (indiceImagen - 1 + imagenesModal.length) % imagenesModal.length;
      mostrarImagenModal();
    };
    document.querySelector(".next").onclick = () => {
      indiceImagen = (indiceImagen + 1) % imagenesModal.length;
      mostrarImagenModal();
    };

    closeModal.onclick = () => modal.style.display = "none";
    window.onclick = e => { if (e.target == modal) modal.style.display = "none"; };

    // Fullscreen al hacer click en imagen del modal
    modalImagen.onclick = () => {
      fullscreenView.style.display = "flex";
      fullscreenImg.src = modalImagen.src;
    };
    closeFullscreen.onclick = () => fullscreenView.style.display = "none";

    // Cargar directo por URL
    function verificarParametroURL() {
      const params = new URLSearchParams(window.location.search);
      if (params.has("producto")) {
        const nombre = decodeURIComponent(params.get("producto"));
        const prod = productos.find(p => p.Nombre === nombre);
        if (prod) abrirModal(productos.indexOf(prod));
      }
    }
  </script>
</body>
</html>
